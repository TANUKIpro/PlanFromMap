# ViewCube - 3D視点制御

## 概要

ViewCubeは、3Dビューの視点を直感的に制御するためのインタラクティブな3Dウィジェットです。立方体の面、辺、頂点をクリックすることで、カメラの方向を素早く変更できます。

## 機能

### インタラクティブ要素

ViewCubeは以下の26個のインタラクティブ要素を提供します：

#### 1. 6つの面
- **前面**: カメラを前方から見た視点
- **背面**: カメラを後方から見た視点
- **左面**: カメラを左側から見た視点
- **右面**: カメラを右側から見た視点
- **上面**: カメラを真上から見た視点
- **下面**: カメラを真下から見た視点

#### 2. 12本の辺
- 辺をクリックすると、その辺に沿った斜め45度の視点に切り替わります
- 水平方向と垂直方向の中間視点を提供

#### 3. 8つの頂点
- 頂点をクリックすると、等角投影の標準視点（斜め上からの視点）に切り替わります
- 3Dモデルの全体像を把握するのに最適な視点

### ビジュアルフィードバック

#### ホバー効果
- マウスをホバーすると、その要素が強調表示されます
  - 面: 青い半透明の色で強調
  - 辺: 青い太い線で強調
  - 頂点: 青い円で強調

#### 現在の視点表示
- 現在のカメラ方向に対応する要素が特別な色で表示されます
  - 面: 濃い青色
  - 辺/頂点: オレンジ色

#### 方向インジケーター
- ViewCube下部に現在の回転角度と傾き角度が表示されます
- 形式: `回転角度° / 傾き角度°`

## 技術仕様

### 描画システム

#### 等角投影
ViewCube自体は固定の等角投影視点で描画されます：
- Y軸回転: 45度
- X軸回転: 25度

#### バックフェースカリング
- 裏面の面は描画されません
- 法線ベクトルを使用して表裏を判定

#### 深度ソート
- 面は奥から手前へと正しい順序で描画されます
- Z座標を使用して描画順序を決定

### 当たり判定

#### 優先順位
1. **頂点**: 8px以内の円形領域
2. **辺**: 6px以内の線分近傍
3. **面**: ポリゴン内部（Ray Casting法）

### 高DPI対応
- デバイスのピクセル比（devicePixelRatio）を考慮
- Retina ディスプレイなどで鮮明に表示

## 実装詳細

### ファイル構成

```
apps/frontend/static/
├── js/
│   └── ui/
│       └── viewCube.js          # ViewCubeのメイン実装
├── styles/
│   ├── view-3d.css              # 3DビューのViewCubeスタイル
│   └── tabs.css                 # カタログのViewCubeスタイル
```

### 使用方法

```javascript
import { initializeViewCube, updateViewCube } from './ui/viewCube.js';

// 初期化
const canvas = document.getElementById('viewCubeCanvas');
initializeViewCube(canvas, (rotation, tilt) => {
    // 視点変更時のコールバック
    console.log(`新しい視点: 回転=${rotation}°, 傾き=${tilt}°`);
    // カメラを更新
    updateCamera(rotation, tilt);
});

// 外部からViewCubeを更新
updateViewCube(45, 30);
```

### 視点プリセット

ViewCubeは以下の視点プリセットを提供します：

#### 面の視点
| 面 | 回転角度 | 傾き角度 |
|----|---------|---------|
| 前 | 0° | 0° |
| 後 | 180° | 0° |
| 左 | -90° | 0° |
| 右 | 90° | 0° |
| 上 | 45° | 90° |
| 下 | 45° | -90° |

#### 頂点の視点（等角投影）
| 頂点位置 | 回転角度 | 傾き角度 |
|---------|---------|---------|
| 左下奥 | -135° | -30° |
| 右下奥 | 135° | -30° |
| 右上奥 | 135° | 30° |
| 左上奥 | -135° | 30° |
| 左下手前 | -45° | -30° |
| 右下手前 | 45° | -30° |
| 右上手前 | 45° | 30° |
| 左上手前 | -45° | 30° |

#### 辺の視点
辺は隣接する2つの面の中間視点を提供します（45度の傾き）。

## カスタマイズ

### サイズ変更

```javascript
// viewCube.js内
const viewCubeState = {
    size: 150,      // ViewCube全体のサイズ
    cubeSize: 40,   // キューブの論理サイズ
    // ...
};
```

対応するCSSも更新してください：

```css
.view-cube-container {
    width: 150px;
    height: 150px;
}
```

### 色のカスタマイズ

```javascript
// viewCube.js内のdrawFace関数
if (isCurrent) {
    ctx.fillStyle = 'rgba(102, 126, 234, 0.8)'; // 現在の視点の色
} else if (isHovered) {
    ctx.fillStyle = 'rgba(102, 126, 234, 0.4)'; // ホバー時の色
} else {
    ctx.fillStyle = 'rgba(226, 232, 240, 0.6)'; // 通常時の色
}
```

## 参考実装

このViewCubeは以下のプロジェクトを参考にしています：
- [bevy_viewcube by Donvlouss](https://github.com/Donvlouss/bevy_viewcube)
- [bevy_viewcube by PhaestusFox](https://github.com/PhaestusFox/bevy_viewcube)

## パフォーマンス最適化

### 描画の最適化
- ホバー状態が変更された時のみ再描画
- 通常時は辺と頂点を描画しない（面の枠線で十分）

### イベント処理の最適化
- 要素の判定は優先順位順に実行（頂点 → 辺 → 面）
- 最初にマッチした要素で処理を終了

## トラブルシューティング

### ViewCubeが表示されない
1. Canvas要素が正しく配置されているか確認
2. CSSのz-indexが適切に設定されているか確認
3. ブラウザのコンソールでエラーを確認

### クリックが反応しない
1. Canvas要素のpointer-eventsが有効か確認
2. 他の要素がViewCubeを覆っていないか確認
3. 当たり判定の閾値を調整（viewCube.js内）

### 表示がぼやける
- 高DPI対応のコードが正しく実装されているか確認
- devicePixelRatioが正しく適用されているか確認

## 今後の拡張案

1. **アニメーション効果**
   - 視点切り替え時のスムーズなトランジション
   - ホバー時のアニメーション効果

2. **カスタムラベル**
   - 面のラベルをカスタマイズ可能に
   - 多言語対応

3. **テーマ対応**
   - ライト/ダークテーマ
   - カスタムカラースキーム

4. **追加視点**
   - ユーザー定義の視点プリセット
   - お気に入り視点の保存

## ライセンス

このプロジェクトの一部として、同じライセンスが適用されます。
