<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è Semantic Map Platform for HSR</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

    <!-- CSS Modules -->
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/map-viewer.css">
    <link rel="stylesheet" href="styles/drawing-tools.css">
    <link rel="stylesheet" href="styles/layers-panel.css">
    <link rel="stylesheet" href="styles/metadata-overlay.css">
    <link rel="stylesheet" href="styles/tabs.css">
    <link rel="stylesheet" href="styles/menu-bar.css">
</head>
<body>
    <div class="container">
        <!-- Èö†„Åó„Éï„Ç°„Ç§„É´ÂÖ•Âäõ -->
        <input type="file" id="imageFileInput" accept="image/*,.pgm" style="display: none;" onchange="handleImageFileSelect(event)">
        <input type="file" id="yamlFileInput" accept=".yaml,.yml" style="display: none;" onchange="handleYAMLFileSelect(event)">

        <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„Éä -->
        <div class="tabs-container">
            <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('mapViewer', event)">üó∫Ô∏è „Éû„ÉÉ„Éó„Éì„É•„Éº„Ç¢</button>
                <button class="tab-button" onclick="switchTab('stats', event)">üìä „Ç∑„Çπ„ÉÜ„É†Áµ±Ë®à</button>
                <button class="tab-button" onclick="switchTab('operations', event)">üö™ Êìç‰Ωú„Ç´„Çø„É≠„Ç∞</button>
                <button class="tab-button" onclick="switchTab('mapql', event)">üîç MapQL„ÇØ„Ç®„É™</button>
            </div>

            <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div id="mapViewer" class="tab-content active">
                <div class="map-viewer-tab">
                    <!-- „É°„Éã„É•„Éº„Éê„Éº -->
                    <div class="menu-bar">
                        <!-- „Éï„Ç°„Ç§„É´„É°„Éã„É•„Éº -->
                        <div class="menu-bar__item">
                            <button class="menu-bar__button" onclick="toggleMenu('fileMenu')">„Éï„Ç°„Ç§„É´</button>
                            <div id="fileMenu" class="menu-bar__dropdown">
                                <button class="menu-bar__dropdown-item" onclick="loadImageFile(); closeAllMenus();">ÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄ...</button>
                                <button class="menu-bar__dropdown-item" onclick="loadYAMLFile(); closeAllMenus();">YAML„ÇíË™≠„ÅøËæº„ÇÄ...</button>
                                <div class="menu-bar__dropdown-divider"></div>
                                <button class="menu-bar__dropdown-item" onclick="showProfileManager(); closeAllMenus();">„Éó„É≠„Éï„Ç°„Ç§„É´ÁÆ°ÁêÜ</button>
                                <div class="menu-bar__dropdown-divider"></div>
                                <button class="menu-bar__dropdown-item" onclick="clearMap(); closeAllMenus();">„Éû„ÉÉ„Éó„Çí„ÇØ„É™„Ç¢</button>
                            </div>
                        </div>

                        <!-- Á∑®ÈõÜ„É°„Éã„É•„Éº -->
                        <div class="menu-bar__item">
                            <button class="menu-bar__button" onclick="toggleMenu('editMenu')">Á∑®ÈõÜ</button>
                            <div id="editMenu" class="menu-bar__dropdown">
                                <button class="menu-bar__dropdown-item" id="menuUndoButton" onclick="undo(); closeAllMenus();" disabled>
                                    Êàª„Çã
                                    <span class="menu-bar__shortcut">Ctrl+Z</span>
                                </button>
                                <button class="menu-bar__dropdown-item" id="menuRedoButton" onclick="redo(); closeAllMenus();" disabled>
                                    ÈÄ≤„ÇÄ
                                    <span class="menu-bar__shortcut">Ctrl+Y</span>
                                </button>
                            </div>
                        </div>

                        <!-- Ë°®Á§∫„É°„Éã„É•„Éº -->
                        <div class="menu-bar__item">
                            <button class="menu-bar__button" onclick="toggleMenu('viewMenu')">Ë°®Á§∫</button>
                            <div id="viewMenu" class="menu-bar__dropdown">
                                <button class="menu-bar__dropdown-item" onclick="resetView(); closeAllMenus();">Ë°®Á§∫„É™„Çª„ÉÉ„Éà</button>
                                <button class="menu-bar__dropdown-item" onclick="zoomIn(); closeAllMenus();">
                                    Êã°Â§ß
                                    <span class="menu-bar__shortcut">+</span>
                                </button>
                                <button class="menu-bar__dropdown-item" onclick="zoomOut(); closeAllMenus();">
                                    Á∏ÆÂ∞è
                                    <span class="menu-bar__shortcut">-</span>
                                </button>
                                <div class="menu-bar__dropdown-divider"></div>
                                <div class="menu-bar__dropdown-submenu">
                                    <label class="menu-bar__dropdown-label" for="gridWidthInput">„Ç∞„É™„ÉÉ„ÉâÂπÖ (cm):</label>
                                    <input type="number" id="gridWidthInput" class="menu-bar__dropdown-input" min="1" max="1000" value="10" onchange="updateGridWidth(this.value)">
                                </div>
                                <div class="menu-bar__dropdown-divider"></div>
                                <div class="menu-bar__dropdown-submenu">
                                    <label class="menu-bar__dropdown-checkbox">
                                        <input type="checkbox" id="snapToGridCheckbox" onchange="toggleSnapToGrid(this.checked)">
                                        <span id="snapToGridLabel">„Çπ„Éä„ÉÉ„Éó</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="map-canvas-container" id="mapContainer">
                        <div class="map-placeholder" id="mapPlaceholder">
                            <div style="text-align: center;">
                                <p style="margin-bottom: 20px; color: #999;">„Éó„É≠„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
                            </div>
                        </div>
                        <div id="canvasStack" class="canvas-stack" style="display: none;"></div>
                        <canvas id="mapCanvas" style="display: none;"></canvas>

                        <!-- ÊèèÁîª„ÉÑ„Éº„É´„Éë„É¨„ÉÉ„Éà -->
                        <div class="drawing-tools-palette hidden" id="drawingToolsPalette">
                            <div class="drawing-tools-body">
                                <button class="tool-button active" id="panTool" onclick="selectTool('pan')" title="„Éë„É≥ÔºàÁßªÂãïÔºâ">
                                    ‚úã
                                </button>
                                <button class="tool-button" id="pencilTool" onclick="selectTool('pencil')" title="ÈâõÁ≠Ü">
                                    ‚úèÔ∏è
                                </button>
                                <button class="tool-button" id="eraserTool" onclick="selectTool('eraser')" title="Ê∂à„Åó„Ç¥„É†">
                                    üßπ
                                </button>
                                <button class="tool-button" id="measureTool" onclick="selectTool('measure')" title="Ê∏¨Èáè">
                                    üìè
                                </button>
                                <button class="tool-button" id="bucketTool" onclick="selectTool('bucket')" title="Â°ó„Çä„Å§„Å∂„Åó">
                                    ü™£
                                </button>
                                <div class="tool-divider"></div>
                                <div class="tool-divider"></div>
                                <button class="tool-button" id="rectangleTool" onclick="toggleRectangleToolMode()" title="ÂõõËßíÂΩ¢Ôºà„Ç™„É≥/„Ç™„ÉïÔºâ">
                                    ‚ñ≠
                                </button>
                                <div class="tool-divider"></div>
                                <div class="color-picker-wrapper">
                                    <div class="color-picker-label">Ëâ≤</div>
                                    <input type="color" class="color-picker-input" id="colorPicker" value="#FF0000" onchange="changeDrawingColor(this.value)">
                                </div>
                                <div class="brush-size-control">
                                    <div class="brush-size-label">„Çµ„Ç§„Ç∫: <span id="brushSizeValue">5</span></div>
                                    <input type="range" class="brush-size-slider" id="brushSizeSlider" min="1" max="50" value="5" oninput="changeBrushSize(this.value)">
                                </div>
                            </div>
                            <button class="drawing-tools-toggle" id="drawingToolsToggle" onclick="toggleDrawingToolsVisibility()" title="ÊèèÁîª„ÉÑ„Éº„É´„ÇíË°®Á§∫/ÈùûË°®Á§∫">
                                ‚ñº
                            </button>
                        </div>

                        <!-- „É¨„Ç§„É§„Éº„Éë„Éç„É´ -->
                        <div class="layers-panel hidden" id="layersPanel">
                            <button class="layers-panel-toggle" id="layersPanelToggle" onclick="toggleLayersPanelVisibility()" title="„É¨„Ç§„É§„Éº„ÇíË°®Á§∫/ÈùûË°®Á§∫">
                                ‚Üí
                            </button>
                            <div class="layers-panel-header">
                                <span class="layers-panel-title">
                                    üìö „É¨„Ç§„É§„Éº
                                </span>
                                <button class="layer-add-button" onclick="addNewLayer()">+ ËøΩÂä†</button>
                            </div>
                            <div class="layers-panel-body" id="layersPanelBody">
                                <!-- „É¨„Ç§„É§„Éº„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
                            </div>
                        </div>

                        <div class="metadata-overlay-panel minimized" id="metadataOverlay" aria-hidden="true">
                            <div class="metadata-overlay-header" onclick="toggleMetadataMinimize()" data-tooltip="„Éû„ÉÉ„Éó„É°„Çø„Éá„Éº„Çø">
                                <span class="metadata-overlay-icon">M</span>
                                <span class="metadata-overlay-title">üìã „Éû„ÉÉ„Éó„É°„Çø„Éá„Éº„Çø</span>
                                <button
                                    type="button"
                                    class="metadata-overlay-minimize"
                                    onclick="event.stopPropagation(); toggleMetadataMinimize()"
                                    title="ÊúÄÂ∞èÂåñ"
                                >
                                    <span class="metadata-overlay-minimize-icon">‚ñæ</span>
                                </button>
                            </div>
                            <div class="metadata-overlay-body" id="metadataOverlayBody">
                                <div class="metadata-overlay-section metadata-overlay-info" id="metadataOverlayInfo">
                                    <div class="metadata-overlay-list" id="metadataOverlayContent"></div>
                                </div>
                                <div class="metadata-overlay-section metadata-overlay-options inactive" id="metadataOverlayOptions">
                                    <div class="metadata-overlay-section-title">Ë°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥</div>
                                    <div class="metadata-overlay-toggle-list">
                                        <label class="metadata-overlay-toggle metadata-toggle">
                                            <span>„É°„Çø„Éá„Éº„Çø„Ç™„Éº„Éê„Éº„É¨„Ç§</span>
                                            <input type="checkbox" id="metadataLayerToggle" checked onchange="toggleLayer('metadataOverlay', this.checked)">
                                        </label>
                                        <label class="metadata-overlay-toggle metadata-dependent">
                                            <span>1m„Ç∞„É™„ÉÉ„Éâ</span>
                                            <input type="checkbox" id="gridOverlayToggle" data-option="showGrid" checked onchange="toggleOverlayOption('showGrid', this.checked)">
                                        </label>
                                        <label class="metadata-overlay-toggle metadata-dependent">
                                            <span>ÂéüÁÇπ„Éû„Éº„Ç´„Éº</span>
                                            <input type="checkbox" id="originOverlayToggle" data-option="showOrigin" checked onchange="toggleOverlayOption('showOrigin', this.checked)">
                                        </label>
                                        <label class="metadata-overlay-toggle metadata-dependent">
                                            <span>„Çπ„Ç±„Éº„É´„Éê„Éº</span>
                                            <input type="checkbox" id="scaleOverlayToggle" data-option="showScaleBar" checked onchange="toggleOverlayOption('showScaleBar', this.checked)">
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="stats" class="tab-content">
                <div class="stats" id="statsContent">
                    <div class="loading">Áµ±Ë®àÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                </div>
            </div>

            <div id="operations" class="tab-content">
                <div class="operations" id="operationsContent">
                    <div class="loading">Êìç‰Ωú„Ç´„Çø„É≠„Ç∞„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                </div>
            </div>

            <div id="mapql" class="tab-content">
                <div class="query-section">
                    <input
                        type="text"
                        class="query-input"
                        id="queryInput"
                        placeholder="‰æã: GET Operation FOR 'kitchen_door'"
                    >
                    <button class="query-button" onclick="executeQuery()">„ÇØ„Ç®„É™ÂÆüË°å</button>
                    <div id="queryResult"></div>
                </div>
            </div>
        </div>

        <!-- „Éó„É≠„Éï„Ç°„Ç§„É´ÁÆ°ÁêÜ„É¢„Éº„ÉÄ„É´ -->
        <div id="profileManagerModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üíæ „Éó„É≠„Éï„Ç°„Ç§„É´ÁÆ°ÁêÜ</h2>
                    <button class="modal-close" onclick="closeProfileManager()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="profile-section">
                        <h3>ÁèæÂú®„ÅÆ„Éó„É≠„Éï„Ç°„Ç§„É´„Çí‰øùÂ≠ò</h3>
                        <div class="profile-save-form">
                            <input type="text" id="profileNameInput" placeholder="„Éó„É≠„Éï„Ç°„Ç§„É´Âêç„ÇíÂÖ•Âäõ" class="profile-input">
                            <button onclick="saveCurrentProfile()" class="profile-button save">‰øùÂ≠ò</button>
                        </div>
                    </div>
                    <div class="profile-section">
                        <h3>‰øùÂ≠ò„Åï„Çå„Åü„Éó„É≠„Éï„Ç°„Ç§„É´</h3>
                        <div id="profileList" class="profile-list">
                            <!-- „Éó„É≠„Éï„Ç°„Ç§„É´‰∏ÄË¶ß„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Module -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
