# CI/CD Documentation

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Semantic Map Platform ã®CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¦‚è¦

### 1. Test Suite (`test.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**:
- `push` ã‚¤ãƒ™ãƒ³ãƒˆ: `main`, `develop`, `claude/**` ãƒ–ãƒ©ãƒ³ãƒ
- `pull_request` ã‚¤ãƒ™ãƒ³ãƒˆ: `main`, `develop` ãƒ–ãƒ©ãƒ³ãƒ

**ã‚¸ãƒ§ãƒ–æ§‹æˆ**:

#### a. Unit Tests
- **ä¸¦åˆ—å®Ÿè¡Œ**: Python 3.8, 3.9, 3.10, 3.11
- **å®Ÿè¡Œå†…å®¹**:
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆå¿…é ˆï¼‰
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆ360åˆ†ï¼‰
- **æˆæœç‰©**: ãƒ†ã‚¹ãƒˆçµæœã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ7æ—¥é–“ä¿æŒï¼‰

#### b. Integration Tests
- **ä¾å­˜**: Unit Testså®Œäº†å¾Œ
- **å®Ÿè¡Œå†…å®¹**:
  - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
  - çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **æˆæœç‰©**: çµ±åˆãƒ†ã‚¹ãƒˆçµæœï¼ˆ7æ—¥é–“ä¿æŒï¼‰

#### c. Coverage Report
- **ä¾å­˜**: Unit Testså®Œäº†å¾Œ
- **å®Ÿè¡Œå†…å®¹**:
  - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆXML, HTML, ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
  - GitHub Step Summaryã«ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- **æˆæœç‰©**: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ30æ—¥é–“ä¿æŒï¼‰

#### d. E2E Tests
- **ä¾å­˜**: Unit Tests + Integration Testså®Œäº†å¾Œ
- **æ¡ä»¶**: PRã¾ãŸã¯mainãƒ–ãƒ©ãƒ³ãƒã¸ã®push
- **å®Ÿè¡Œå†…å®¹**:
  - é€šå¸¸E2Eãƒ†ã‚¹ãƒˆï¼ˆ10åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
  - ã‚¹ãƒ­ãƒ¼E2Eãƒ†ã‚¹ãƒˆï¼ˆ30åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€PRæ™‚ã®ã¿ï¼‰
- **æˆæœç‰©**: E2Eãƒ†ã‚¹ãƒˆçµæœã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆ14æ—¥é–“ä¿æŒï¼‰

#### e. Test Summary
- **ä¾å­˜**: ã™ã¹ã¦ã®ä¸»è¦ã‚¸ãƒ§ãƒ–å®Œäº†å¾Œ
- **å®Ÿè¡Œå†…å®¹**:
  - ãƒ†ã‚¹ãƒˆçµæœã®é›†ç´„
  - GitHub Step Summaryã«ç·åˆãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º

### 2. PR Check (`pr-check.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**: Pull Requestï¼ˆopened, synchronize, reopenedï¼‰

**ã‚¸ãƒ§ãƒ–æ§‹æˆ**:

#### a. PR Validation
- PRã‚¿ã‚¤ãƒˆãƒ«ã®Conventional Commitså½¢å¼ãƒã‚§ãƒƒã‚¯
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§è¡¨ç¤º
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª

#### b. Quick Test
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
- é«˜é€Ÿãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆ2åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
- æœ€å¤§3ä»¶ã®å¤±æ•—ã§åœæ­¢

#### c. PR Size Check
- è¿½åŠ ãƒ»å‰Šé™¤è¡Œæ•°ã®é›†è¨ˆ
- PRã‚µã‚¤ã‚ºã®è©•ä¾¡ï¼ˆSmall/Medium/Largeï¼‰

#### d. Code Quality Check
- Pythonæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
- print()æ–‡ã®æ¤œå‡ºï¼ˆè­¦å‘Šï¼‰
- TODOã‚³ãƒ¡ãƒ³ãƒˆã®ã‚«ã‚¦ãƒ³ãƒˆ

#### e. PR Summary
- å…¨ãƒã‚§ãƒƒã‚¯çµæœã®é›†ç´„è¡¨ç¤º

### 3. Scheduled Tests (`scheduled-tests.yml`)

**ãƒˆãƒªã‚¬ãƒ¼**:
- Cron: æ¯æ—¥2:00 UTC
- æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼å¯èƒ½

**ã‚¸ãƒ§ãƒ–æ§‹æˆ**:

#### a. Full Test Suite
- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
- ã‚¹ãƒ­ãƒ¼E2Eãƒ†ã‚¹ãƒˆã‚‚å«ã‚€ï¼ˆ60åˆ†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **å¤±æ•—æ™‚ã®è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: GitHubã‚¤ã‚·ãƒ¥ãƒ¼ä½œæˆ

#### b. Performance Tests
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- å®Ÿè¡Œæ™‚é–“ã®è¨˜éŒ²
- ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã®ä¿å­˜

## ğŸ”§ è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ç’°å¢ƒå¤‰æ•°

ç¾åœ¨ã€ç‰¹åˆ¥ãªç’°å¢ƒå¤‰æ•°ã¯ä¸è¦ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ä»¥ä¸‹ã‚’è¿½åŠ ã§ãã¾ã™ï¼š

```yaml
env:
  PYTHONPATH: ${{ github.workspace }}
  TEST_ENV: ci
```

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

ç¾åœ¨ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ä¸è¦ã§ã™ã€‚å°†æ¥çš„ã«ä»¥ä¸‹ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

- `CODECOV_TOKEN`: Codecovçµ±åˆç”¨
- `SLACK_WEBHOOK`: Slacké€šçŸ¥ç”¨

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

å„ã‚¸ãƒ§ãƒ–ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã§ã™ï¼š

```yaml
timeout-minutes: 10  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯360åˆ†
```

## ğŸ“Š æˆæœç‰©ï¼ˆArtifactsï¼‰

### ä¿æŒæœŸé–“

| æˆæœç‰© | ä¿æŒæœŸé–“ | å†…å®¹ |
|--------|----------|------|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆçµæœ | 7æ—¥ | ãƒ†ã‚¹ãƒˆçµæœã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| çµ±åˆãƒ†ã‚¹ãƒˆçµæœ | 7æ—¥ | ãƒ†ã‚¹ãƒˆçµæœã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ | 30æ—¥ | HTML, XML |
| E2Eãƒ†ã‚¹ãƒˆçµæœ | 14æ—¥ | çµæœã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ |
| å®šæœŸãƒ†ã‚¹ãƒˆçµæœ | 30æ—¥ | å…¨ãƒ†ã‚¹ãƒˆçµæœ |

### ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ–¹æ³•

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã® "Actions" ã‚¿ãƒ–ã«ç§»å‹•
2. è©²å½“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’ã‚¯ãƒªãƒƒã‚¯
3. "Artifacts" ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

## ğŸš€ ä½¿ã„æ–¹

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆ
pytest

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿
pytest tests/unit/ -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pytest --cov=apps --cov-report=html
```

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ‰‹å‹•å®Ÿè¡Œ

1. GitHubã® "Actions" ã‚¿ãƒ–ã«ç§»å‹•
2. "Scheduled Tests" ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
3. "Run workflow" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

### PRã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯

PRã‚’ä½œæˆã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

1. **PR Validation**: ã‚¿ã‚¤ãƒˆãƒ«ã€å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
2. **Quick Test**: é«˜é€Ÿãƒ†ã‚¹ãƒˆï¼ˆ2åˆ†ï¼‰
3. **PR Size Check**: PRã‚µã‚¤ã‚ºè©•ä¾¡
4. **Code Quality**: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

ã™ã¹ã¦é€šéå¾Œã€å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹

**åŸå› **: E2Eãƒ†ã‚¹ãƒˆãŒé•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã‚‹

**è§£æ±ºç­–**:
```yaml
timeout-minutes: 30  # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·
```

#### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—

**åŸå› **: requirements.txtã®æ›´æ–°æ¼ã‚Œ

**è§£æ±ºç­–**:
```bash
pip freeze > requirements.txt
git add requirements.txt
git commit -m "chore: update dependencies"
```

#### 3. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œãªã„

**åŸå› **: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã„ã‚‹

**è§£æ±ºç­–**:
```yaml
continue-on-error: true  # ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
```

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

#### ãƒ­ã‚°ã®ç¢ºèª

1. Actions ã‚¿ãƒ–ã‹ã‚‰è©²å½“ã®å®Ÿè¡Œã‚’é¸æŠ
2. å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ­ã‚°ã‚’å±•é–‹ã—ã¦è©³ç´°ã‚’ç¢ºèª

#### ãƒ­ãƒ¼ã‚«ãƒ«ã§å†ç¾

```bash
# åŒã˜Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè¡Œ
pyenv install 3.11
pyenv local 3.11
pip install -r requirements.txt
pytest tests/unit/frontend/ -v
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨

```yaml
- uses: actions/setup-python@v4
  with:
    cache: 'pip'  # pipä¾å­˜é–¢ä¿‚ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

### ä¸¦åˆ—å®Ÿè¡Œ

```yaml
strategy:
  matrix:
    python-version: ['3.8', '3.9', '3.10', '3.11']
```

### æ¡ä»¶ä»˜ãå®Ÿè¡Œ

```yaml
if: github.event_name == 'pull_request'  # PRæ™‚ã®ã¿å®Ÿè¡Œ
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ç®¡ç†**: GitHub Secretsã‚’ä½¿ç”¨
2. **æ¨©é™ã®æœ€å°åŒ–**: `permissions:` ã‚’æ˜ç¤ºçš„ã«è¨­å®š
3. **ä¾å­˜é–¢ä¿‚ã®æ›´æ–°**: Dependabotã‚’æœ‰åŠ¹åŒ–

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆä»Šå¾Œè¿½åŠ äºˆå®šï¼‰

```yaml
- name: Run security scan
  uses: pypa/gh-action-pip-audit@v1
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [GitHub Actions Documentation](https://docs.github.com/actions)
- [pytest Documentation](https://docs.pytest.org/)
- [Test Suite README](../tests/README.md)
- [AI Guidelines](../AI_GUIDELINES.md)

## ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ›´æ–°

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ›´æ–°ã™ã‚‹éš›ã¯ï¼š

1. `.github/workflows/` å†…ã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
2. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
3. PRã‚’ä½œæˆã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼
4. ãƒãƒ¼ã‚¸å¾Œã€è‡ªå‹•çš„ã«æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒé©ç”¨ã•ã‚Œã‚‹

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
2. GitHubã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ä½œæˆ
3. Actions ã‚¿ãƒ–ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å±¥æ­´ã‚’ç¢ºèª
